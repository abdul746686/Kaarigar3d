<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kaarigar3D - Mobile Furniture Designer</title>
    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', sans-serif;
            overflow: hidden;
            touch-action: none;
            height: 100vh;
            width: 100vw;
            position: fixed;
        }
        
        #app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
        }
        
        #header {
            background-color: #2c3e50;
            color: white;
            padding: 8px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 50px;
            flex-shrink: 0;
        }
        
        #logo {
            font-size: 18px;
            font-weight: bold;
            display: flex;
            align-items: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        #logo img {
            height: 30px;
            margin-right: 8px;
        }
        
        #header-buttons {
            display: flex;
            gap: 6px;
        }
        
        .header-btn {
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 8px;
            font-size: 12px;
            white-space: nowrap;
        }
        
        #main-container {
            display: flex;
            flex-direction: column;
            flex: 1;
            overflow: hidden;
            position: relative;
        }
        
        #viewer-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            touch-action: none;
        }
        
        #viewer {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        #mobile-toolbar {
            position: absolute;
            bottom: 10px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            z-index: 100;
            pointer-events: none;
        }
        
        #tool-buttons {
            display: flex;
            background-color: rgba(52, 73, 94, 0.8);
            border-radius: 20px;
            padding: 5px;
            pointer-events: auto;
        }
        
        .tool-button {
            width: 40px;
            height: 40px;
            margin: 0 3px;
            background-color: #2c3e50;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
        }
        
        .tool-button.active {
            background-color: #3498db;
        }
        
        #properties-panel {
            position: fixed;
            top: 50px;
            right: -300px;
            width: 280px;
            height: calc(100vh - 80px);
            background-color: #ecf0f1;
            padding: 15px;
            overflow-y: auto;
            z-index: 200;
            transition: transform 0.3s ease;
            box-shadow: -2px 0 5px rgba(0,0,0,0.2);
        }
        
        #properties-panel.open {
            transform: translateX(-300px);
        }
        
        .property-group {
            margin-bottom: 15px;
            border-bottom: 1px solid #bdc3c7;
            padding-bottom: 10px;
        }
        
        .property-group h3 {
            margin-top: 0;
            color: #2c3e50;
            font-size: 16px;
        }
        
        .property-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        select, input {
            padding: 5px;
            border-radius: 3px;
            border: 1px solid #bdc3c7;
            font-size: 14px;
            width: 120px;
        }
        
        input[type="number"] {
            text-align: right;
        }
        
        input[type="color"] {
            height: 30px;
            width: 60px;
            padding: 2px;
        }
        
        #status-bar {
            background-color: #2c3e50;
            color: white;
            padding: 5px 10px;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            height: 30px;
            flex-shrink: 0;
        }
        
        #unit-selector, #language-selector {
            background-color: #34495e;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 2px 5px;
            font-size: 12px;
            margin-left: 5px;
        }
        
        #menu-btn {
            position: absolute;
            top: 60px;
            left: 10px;
            background-color: rgba(52, 73, 94, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        /* Selection highlight */
        .selected-object {
            outline: 2px solid #3498db;
            outline-offset: 2px;
        }
        
        /* Mobile-specific optimizations */
        @media (max-width: 480px) {
            .tool-button {
                width: 36px;
                height: 36px;
                font-size: 16px;
            }
            
            #properties-panel {
                width: 90vw;
                right: -90vw;
            }
            
            #properties-panel.open {
                transform: translateX(-90vw);
            }
            
            select, input {
                width: 100px;
            }
        }
    </style>
</head>
<body>
    <div id="app-container">
        <div id="header">
            <div id="logo">
                <img src="https://via.placeholder.com/30" alt="Kaarigar3D Logo">
                <span>Kaarigar3D</span>
            </div>
            <div id="header-buttons">
                <button class="header-btn" id="new-project-btn">New</button>
                <button class="header-btn" id="save-btn">Save</button>
            </div>
        </div>
        
        <div id="main-container">
            <button id="menu-btn">‚ò∞</button>
            
            <div id="viewer-container">
                <canvas id="viewer"></canvas>
                
                <div id="mobile-toolbar">
                    <div id="tool-buttons">
                        <button class="tool-button active" title="Select" data-tool="select">‚ú•</button>
                        <button class="tool-button" title="Rectangle" data-tool="rectangle">‚ñØ</button>
                        <button class="tool-button" title="Push/Pull" data-tool="pushpull">‚á≥</button>
                        <button class="tool-button" title="Move" data-tool="move">‚Üë</button>
                        <button class="tool-button" title="Measure" data-tool="measure">üìè</button>
                    </div>
                </div>
            </div>
            
            <div id="properties-panel">
                <div class="property-group">
                    <h3>Object Properties</h3>
                    <div class="property-row">
                        <label>Name:</label>
                        <input type="text" id="object-name" value="Cabinet">
                    </div>
                    <div class="property-row">
                        <label>Width:</label>
                        <input type="number" id="width" value="100" min="1" step="1">
                    </div>
                    <div class="property-row">
                        <label>Height:</label>
                        <input type="number" id="height" value="100" min="1" step="1">
                    </div>
                    <div class="property-row">
                        <label>Depth:</label>
                        <input type="number" id="depth" value="100" min="1" step="1">
                    </div>
                    <div class="property-row">
                        <label>Position X:</label>
                        <input type="number" id="pos-x" value="0" step="1">
                    </div>
                    <div class="property-row">
                        <label>Position Y:</label>
                        <input type="number" id="pos-y" value="0" step="1">
                    </div>
                    <div class="property-row">
                        <label>Position Z:</label>
                        <input type="number" id="pos-z" value="0" step="1">
                    </div>
                </div>
                
                <div class="property-group">
                    <h3>Material</h3>
                    <div class="property-row">
                        <label>Color:</label>
                        <input type="color" id="material-color" value="#cccccc">
                    </div>
                    <div class="property-row">
                        <label>Texture:</label>
                        <select id="material-texture">
                            <option value="none">None</option>
                            <option value="wood1">Wood Grain</option>
                            <option value="metal">Metal</option>
                        </select>
                    </div>
                    <button id="upload-texture-btn" style="width:100%;padding:8px;margin-top:5px;">Upload Texture</button>
                </div>
                
                <div class="property-group">
                    <h3>Edge Options</h3>
                    <div class="property-row">
                        <label>Round Corners:</label>
                        <input type="checkbox" id="round-corners">
                    </div>
                    <div class="property-row">
                        <label>Radius:</label>
                        <input type="number" id="corner-radius" value="5" min="0" step="1" disabled>
                    </div>
                </div>
                
                <div style="text-align:center;margin-top:20px;">
                    <button id="close-panel-btn" style="padding:8px 15px;">Close</button>
                </div>
            </div>
        </div>
        
        <div id="status-bar">
            <div>
                <span id="coordinates">X:0, Y:0, Z:0</span>
            </div>
            <div>
                <select id="unit-selector">
                    <option value="mm">mm</option>
                    <option value="cm">cm</option>
                    <option value="in">in</option>
                </select>
                <select id="language-selector">
                    <option value="en">EN</option>
                    <option value="hi">HI</option>
                    <option value="ur">UR</option>
                </select>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <script>
        // Initialize Three.js scene
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf0f0f0);
        
        // Set up camera
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / (window.innerHeight - 80), 0.1, 1000);
        camera.position.set(2, 2, 2);
        camera.lookAt(0, 0, 0);
        
        // Set up renderer with mobile optimizations
        const renderer = new THREE.WebGLRenderer({ 
            canvas: document.getElementById('viewer'),
            antialias: true,
            powerPreference: "low-power"
        });
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); // Limit to 2x for performance
        renderer.setSize(window.innerWidth, window.innerHeight - 80);
        
        // Add lights
        const ambientLight = new THREE.AmbientLight(0x404040);
        scene.add(ambientLight);
        
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(1, 1, 1);
        scene.add(directionalLight);
        
        // Add grid helper
        const gridHelper = new THREE.GridHelper(10, 10);
        scene.add(gridHelper);
        
        // Mobile-friendly orbit controls
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.25;
        controls.screenSpacePanning = true;
        
        // Current selected object
        let selectedObject = null;
        
        // Create a sample cabinet
        function createCabinet(width, height, depth) {
            const geometry = new THREE.BoxGeometry(width, height, depth);
            const material = new THREE.MeshStandardMaterial({ 
                color: 0xcccccc,
                roughness: 0.7,
                metalness: 0.1
            });
            const cabinet = new THREE.Mesh(geometry, material);
            cabinet.userData.isSelectable = true;
            return cabinet;
        }
        
        // Add cabinet to scene
        const cabinet = createCabinet(1, 1, 1);
        scene.add(cabinet);
        selectObject(cabinet);
        
        // Function to select an object
        function selectObject(object) {
            // Deselect current object
            if (selectedObject) {
                selectedObject.remove(selectedObject.userData.outline);
                scene.add(selectedObject);
            }
            
            // Select new object
            selectedObject = object;
            
            if (object && object.userData.isSelectable) {
                // Add outline effect
                const outlineGeometry = new THREE.BoxGeometry(
                    object.scale.x * 1.05, 
                    object.scale.y * 1.05, 
                    object.scale.z * 1.05
                );
                const outlineMaterial = new THREE.MeshBasicMaterial({ 
                    color: 0x3498db, 
                    side: THREE.BackSide 
                });
                const outline = new THREE.Mesh(outlineGeometry, outlineMaterial);
                object.add(outline);
                object.userData.outline = outline;
                
                // Update properties panel
                updatePropertiesPanel();
            }
        }
        
        // Update properties panel with selected object's values
        function updatePropertiesPanel() {
            if (!selectedObject) return;
            
            document.getElementById('object-name').value = selectedObject.name || 'Cabinet';
            document.getElementById('width').value = selectedObject.scale.x * 100;
            document.getElementById('height').value = selectedObject.scale.y * 100;
            document.getElementById('depth').value = selectedObject.scale.z * 100;
            document.getElementById('pos-x').value = selectedObject.position.x;
            document.getElementById('pos-y').value = selectedObject.position.y;
            document.getElementById('pos-z').value = selectedObject.position.z;
            
            if (selectedObject.material.color) {
                const color = selectedObject.material.color;
                document.getElementById('material-color').value = `#${color.getHexString()}`;
            }
        }
        
        // Handle window resize
        function onWindowResize() {
            const height = window.innerHeight - 80;
            const width = window.innerWidth;
            
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            renderer.setSize(width, height);
        }
        
        window.addEventListener('resize', onWindowResize);
        
        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
            
            // Update coordinates display
            if (selectedObject) {
                const pos = selectedObject.position;
                document.getElementById('coordinates').textContent = 
                    `X:${pos.x.toFixed(1)}, Y:${pos.y.toFixed(1)}, Z:${pos.z.toFixed(1)}`;
            }
        }
        animate();
        
        // Tool selection
        const toolButtons = document.querySelectorAll('.tool-button');
        toolButtons.forEach(button => {
            button.addEventListener('click', () => {
                toolButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                const tool = button.dataset.tool;
                
                // Visual feedback for mobile
                button.style.transform = 'scale(0.9)';
                setTimeout(() => { button.style.transform = 'scale(1)'; }, 100);
                
                // Tool-specific behaviors
                if (tool === 'select') {
                    alert('Tap on any object to select it');
                } else if (tool === 'pushpull') {
                    alert('Tap a face to push/pull. Pinch to adjust distance.');
                } else if (tool === 'measure') {
                    alert('Tap two points to measure distance between them.');
                }
            });
        });
        
        // Menu button to show properties panel
        document.getElementById('menu-btn').addEventListener('click', () => {
            document.getElementById('properties-panel').classList.add('open');
            updatePropertiesPanel();
        });
        
        // Close properties panel
        document.getElementById('close-panel-btn').addEventListener('click', () => {
            document.getElementById('properties-panel').classList.remove('open');
        });
        
        // Property change handlers for live updates
        document.getElementById('width').addEventListener('input', (e) => {
            if (selectedObject) {
                selectedObject.scale.x = parseFloat(e.target.value) / 100;
                updateOutline();
            }
        });
        
        document.getElementById('height').addEventListener('input', (e) => {
            if (selectedObject) {
                selectedObject.scale.y = parseFloat(e.target.value) / 100;
                updateOutline();
            }
        });
        
        document.getElementById('depth').addEventListener('input', (e) => {
            if (selectedObject) {
                selectedObject.scale.z = parseFloat(e.target.value) / 100;
                updateOutline();
            }
        });
        
        document.getElementById('pos-x').addEventListener('input', (e) => {
            if (selectedObject) {
                selectedObject.position.x = parseFloat(e.target.value);
            }
        });
        
        document.getElementById('pos-y').addEventListener('input', (e) => {
            if (selectedObject) {
                selectedObject.position.y = parseFloat(e.target.value);
            }
        });
        
        document.getElementById('pos-z').addEventListener('input', (e) => {
            if (selectedObject) {
                selectedObject.
